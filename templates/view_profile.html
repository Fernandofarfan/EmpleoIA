{% extends "base.html" %}
{% block content %}

<!-- Modern Header -->
<div class="d-flex justify-content-between align-items-start mb-4">
  <div>
    <div class="d-flex align-items-center gap-3 mb-2">
      <h2 class="fw-bold mb-0">
        <i class="bi bi-person-circle text-primary me-2"></i>Tu Perfil
      </h2>
      {% if role_type %}
      <span class="badge bg-gradient-primary px-3 py-2 fs-6">
        {{ role_type.replace('_', ' ').title() }}
      </span>
      {% endif %}
    </div>
    {% if resume_filename %}
    <p class="text-muted mb-0 small">
      <i class="bi bi-file-earmark-pdf me-1"></i>{{ resume_filename }}
    </p>
    {% endif %}
  </div>
  <div class="d-flex gap-2">
    <a href="/profile" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left me-1"></i> Volver
    </a>
    {% if role_type %}
    <a href="/delete_profile/{{ role_type }}" class="btn btn-outline-danger"
      onclick="return confirm('¿Estás seguro de eliminar este perfil?')">
      <i class="bi bi-trash me-1"></i> Eliminar
    </a>
    {% endif %}
  </div>
</div>

<!-- Stats Overview -->
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="stat-card">
      <div class="stat-icon bg-primary bg-opacity-10">
        <i class="bi bi-gear-fill text-primary"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ profile.skills|length if profile.skills else 0 }}</div>
        <div class="stat-label">Habilidades Técnicas</div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card">
      <div class="stat-icon bg-success bg-opacity-10">
        <i class="bi bi-clock-history text-success"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ profile.experience_years }}</div>
        <div class="stat-label">Años de Experiencia</div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card">
      <div class="stat-icon bg-info bg-opacity-10">
        <i class="bi bi-mortarboard-fill text-info"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ profile.education|length if profile.education else 0 }}</div>
        <div class="stat-label">Educación</div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Left Column: Skills & Experience -->
  <div class="col-lg-6">
    <!-- Technical Skills Card -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white border-0 pt-4 px-4 pb-3">
        <div class="d-flex align-items-center justify-content-between">
          <h5 class="fw-bold mb-0">
            <i class="bi bi-code-slash text-primary me-2"></i>Habilidades Técnicas
          </h5>
          {% if profile.skills %}
          <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25">
            {{ profile.skills|length }} skills
          </span>
          {% endif %}
        </div>
      </div>
      <div class="card-body p-4">
        {% if profile.skills %}
        <div class="skills-cloud">
          {% for skill in profile.skills %}
          <span class="skill-tag">{{ skill }}</span>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-4 text-muted">
          <i class="bi bi-info-circle fs-3 d-block mb-2 opacity-25"></i>
          <p class="mb-0">No se detectaron habilidades técnicas en el CV</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Experience Card -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white border-0 pt-4 px-4 pb-3">
        <h5 class="fw-bold mb-0">
          <i class="bi bi-briefcase text-success me-2"></i>Experiencia
        </h5>
      </div>
      <div class="card-body p-4">
        {% if profile.experience_years > 0 %}
        <div class="experience-display">
          <div class="d-flex align-items-center mb-4">
            <div class="experience-icon">
              <i class="bi bi-award-fill"></i>
            </div>
            <div class="ms-3">
              <div class="experience-years">{{ profile.experience_years }}</div>
              <div class="experience-label">Años de Experiencia</div>
            </div>
          </div>

          <!-- Experience Level Bar -->
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-2">
              <span class="small fw-medium">Nivel de Experiencia</span>
              <span class="badge experience-level-badge">
                {% if profile.experience_years >= 7 %}
                <i class="bi bi-star-fill me-1"></i>Senior
                {% elif profile.experience_years >= 3 %}
                <i class="bi bi-star-half me-1"></i>Mid-Level
                {% elif profile.experience_years >= 1 %}
                <i class="bi bi-star me-1"></i>Junior
                {% else %}
                Entry-Level
                {% endif %}
              </span>
            </div>
            <div class="progress" style="height: 12px; border-radius: 999px;">
              <div class="progress-bar bg-gradient-success" role="progressbar"
                style="width: {{ (profile.experience_years / 10 * 100) | round }}%"
                aria-valuenow="{{ profile.experience_years }}" aria-valuemin="0" aria-valuemax="10">
              </div>
            </div>
            <div class="d-flex justify-content-between mt-1">
              <small class="text-muted">0 años</small>
              <small class="text-muted">10+ años</small>
            </div>
          </div>
        </div>
        {% else %}
        <div class="text-center py-4 text-muted">
          <i class="bi bi-info-circle fs-3 d-block mb-2 opacity-25"></i>
          <p class="mb-0">No se detectaron años de experiencia específicos</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Right Column: Education & Preview -->
  <div class="col-lg-6">
    <!-- Education Card -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white border-0 pt-4 px-4 pb-3">
        <h5 class="fw-bold mb-0">
          <i class="bi bi-mortarboard text-info me-2"></i>Educación
        </h5>
      </div>
      <div class="card-body p-4">
        {% if profile.education %}
        <div class="education-list">
          {% for edu in profile.education %}
          <div class="education-item">
            <div class="education-bullet"></div>
            <div class="education-content">{{ edu }}</div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-4 text-muted">
          <i class="bi bi-info-circle fs-3 d-block mb-2 opacity-25"></i>
          <p class="mb-0">No se detectó información educativa</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Resume Preview Card -->
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-0 pt-4 px-4 pb-3">
        <div class="d-flex align-items-center justify-content-between">
          <h5 class="fw-bold mb-0">
            <i class="bi bi-file-text text-secondary me-2"></i>Vista Previa del CV
          </h5>
          <button class="btn btn-sm btn-outline-secondary" onclick="togglePreview()">
            <i class="bi bi-arrows-angle-expand" id="expandIcon"></i>
          </button>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="resume-preview" id="resumePreview">
          <pre
            class="resume-text">{{ profile.raw_text[:1000] }}{% if profile.raw_text|length > 1000 %}...{% endif %}</pre>
        </div>
        {% if profile.raw_text|length > 1000 %}
        <div class="px-4 pb-3">
          <small class="text-muted">
            <i class="bi bi-info-circle me-1"></i>
            Mostrando los primeros 1000 caracteres. El texto completo se usa para el matching.
          </small>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Success Banner -->
<div class="alert alert-success border-0 shadow-sm mt-4"
  style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
  <div class="d-flex align-items-center">
    <div class="me-3">
      <i class="bi bi-check-circle-fill text-success" style="font-size: 2rem;"></i>
    </div>
    <div class="flex-grow-1">
      <h6 class="fw-bold mb-1 text-success">
        <i class="bi bi-stars me-1"></i>¡Perfil Listo para Matching!
      </h6>
      <p class="mb-0 small text-success-emphasis">
        Tu perfil ha sido analizado exitosamente. Ve a
        <a href="/results" class="fw-bold text-success text-decoration-underline">Resultados</a>
        para encontrar empleos que coincidan con tu perfil y obtener porcentajes de compatibilidad.
      </p>
    </div>
    <a href="/results" class="btn btn-success ms-3">
      Ver Empleos <i class="bi bi-arrow-right ms-1"></i>
    </a>
  </div>
</div>

<style>
  /* Stat Cards */
  .stat-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px -10px rgba(0, 0, 0, 0.15);
    border-color: var(--primary-color);
  }

  .stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
  }

  .stat-content {
    flex: 1;
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #1f2937;
    line-height: 1;
    margin-bottom: 0.25rem;
  }

  .stat-label {
    font-size: 0.875rem;
    color: #6b7280;
    font-weight: 500;
  }

  /* Skills Cloud */
  .skills-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .skill-tag {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 600;
    transition: all 0.2s ease;
  }

  .skill-tag:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  /* Experience Display */
  .experience-display {
    position: relative;
  }

  .experience-icon {
    width: 70px;
    height: 70px;
    border-radius: 16px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2rem;
  }

  .experience-years {
    font-size: 2.5rem;
    font-weight: 700;
    color: #1f2937;
    line-height: 1;
  }

  .experience-label {
    font-size: 0.875rem;
    color: #6b7280;
    font-weight: 500;
  }

  .experience-level-badge {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    color: #92400e;
    font-weight: 600;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
  }

  .bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
  }

  .bg-gradient-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  }

  /* Education List */
  .education-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .education-item {
    display: flex;
    align-items: start;
    gap: 1rem;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 12px;
    border-left: 4px solid #3b82f6;
    transition: all 0.2s ease;
  }

  .education-item:hover {
    background: #eef2ff;
    border-left-color: #4f46e5;
  }

  .education-bullet {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    margin-top: 0.375rem;
    flex-shrink: 0;
  }

  .education-content {
    flex: 1;
    color: #1f2937;
    font-weight: 500;
    line-height: 1.5;
  }

  /* Resume Preview */
  .resume-preview {
    max-height: 400px;
    overflow-y: auto;
    background: #f9fafb;
    padding: 1.5rem;
    border-radius: 0 0 16px 16px;
  }

  .resume-preview.expanded {
    max-height: none;
  }

  .resume-text {
    white-space: pre-wrap;
    font-size: 0.875rem;
    font-family: 'Courier New', monospace;
    color: #374151;
    margin: 0;
    line-height: 1.6;
  }

  /* Scrollbar Styling */
  .resume-preview::-webkit-scrollbar {
    width: 8px;
  }

  .resume-preview::-webkit-scrollbar-track {
    background: #e5e7eb;
    border-radius: 4px;
  }

  .resume-preview::-webkit-scrollbar-thumb {
    background: #9ca3af;
    border-radius: 4px;
  }

  .resume-preview::-webkit-scrollbar-thumb:hover {
    background: #6b7280;
  }

  /* Animations */
  .fade-in {
    animation: fadeIn 0.5s ease-in;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  function togglePreview() {
    const preview = document.getElementById('resumePreview');
    const icon = document.getElementById('expandIcon');

    preview.classList.toggle('expanded');

    if (preview.classList.contains('expanded')) {
      icon.className = 'bi bi-arrows-angle-contract';
    } else {
      icon.className = 'bi bi-arrows-angle-expand';
    }
  }

  // Add fade-in animation on load
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.card, .stat-card, .alert').forEach((el, index) => {
      el.style.animationDelay = `${index * 0.1}s`;
      el.classList.add('fade-in');
    });
  });
</script>

{% endblock %}